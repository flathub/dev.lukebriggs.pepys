app-id: dev.lukebriggs.pepys
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: runner.sh
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  # For user to choose journal directory
  - --filesystem=home
  # To access online content from journals
  - --share=network
modules:
  - name: pepys
    buildsystem: simple
    build-commands:
      - mkdir -p /app/src
      - cp  -r ./src/main /app/src
      - mkdir -p /app/share/metainfo
      - cp dev.lukebriggs.pepys.appdata.xml /app/share/metainfo/
      - mkdir -p /app/share/applications
      - cp dev.lukebriggs.pepys.desktop /app/share/applications/
      - mkdir -p /app/share/icons/hicolor/scalable/apps
      - cp -r ./src/main/resources/base/icons/appicons/base/* /app/share/icons/hicolor
      - cp -r ./src/main/resources/base/icons/appicons/hires/* /app/share/icons/hicolor
      - cp ./dev.lukebriggs.pepys.svg /app/share/icons/hicolor/scalable/apps/
    sources:
      - type: git
        commit: 7e845a5098829db3d4bb064cb957d83b6d832d3c
        tag: v1.0.7
        url: https://github.com/LukeBriggsDev/Pepys

  - python3-requirements.json

  - name: pyqt-x86_64
    buildsystem: simple
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ed/62/cd9f10702c75b242f82da858668fba0cda04cda92133244d3d1555e530b4/PyQt5-5.15.4-cp36.cp37.cp38.cp39-abi3-manylinux2014_x86_64.whl
        sha256: 883a549382fc22d29a0568f3ef20b38c8e7ab633a59498ac4eb63a3bf36d3fd3
      - type: file
        url: https://files.pythonhosted.org/packages/44/48/325c677a5dd5ba2fb2fc90027f79fc851a77b11aec5b64338a9027994e83/PyQt5_sip-12.9.0-cp38-cp38-manylinux1_x86_64.whl
        sha256: fc43f2d7c438517ee33e929e8ae77132749c15909afab6aeece5fcf4147ffdb5
      - type: file
        url: https://files.pythonhosted.org/packages/83/d4/241a6a518d0bcf0a9fcdcbad5edfed18d43e884317eab8d5230a2b27e206/PyQt5_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl
        sha256: 1988f364ec8caf87a6ee5d5a3a5210d57539988bf8e84714c7d60972692e2f4a
      - type: file
        url: https://files.pythonhosted.org/packages/8a/4a/570f9544d872c27d4c71f72c81af6890337a952a1b2923828c8f9dd56244/PyQtWebEngine-5.15.4-cp36.cp37.cp38.cp39-abi3-manylinux2014_x86_64.whl
        sha256: db13f0db983ee2118a3976f646af94417d1279c6b6c0372147c4a3d56c68e58b
      - type: file
        url: https://files.pythonhosted.org/packages/48/62/117c9c96837287b181fce6da481065ddda68b3a8c0fa5f00ea62cc08b877/PyQtWebEngine_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl
        sha256: ec2acb1780c0124ef060c310e00ca701f388d8b6c35bba9127f7a6f0dc536f77
    build-commands:
      - pip3 install PyQt*.whl --target=/app/lib/python3.8/site-packages

  - name: enchant
    sources:
      - type: archive
        url: https://github.com/AbiWord/enchant/releases/download/v2.2.15/enchant-2.2.15.tar.gz
        sha256: 3b0f2215578115f28e2a6aa549b35128600394304bd79d6f28b0d3b3d6f46c03


  - name: pandoc
    buildsystem: simple
    build-commands:
      - install -D bin/pandoc /app/bin/pandoc
    sources:
      - type: archive
        url: https://github.com/jgm/pandoc/releases/download/2.13/pandoc-2.13-linux-amd64.tar.gz
        sha256: 7404aa88a6eb9fbb99d9803b80170a3a546f51959230cc529c66a2ce6b950d4c

  - name: kerberos
    subdir: src
    sources:
      - type: archive
        url: https://web.mit.edu/kerberos/dist/krb5/1.19/krb5-1.19.1.tar.gz
        sha256: fa16f87eb7e3ec3586143c800d7eaff98b5e0dcdf0772af7d98612e49dbeb20b

  - name: wkhtmltopdf
    buildsystem: simple
    build-commands:
      - ar x wkhtmltox_0.12.6-1.buster_amd64.deb
      - tar -xf data.tar.xz
      - cp -r ./usr/local/* /app/
    sources:
      - type: file
        url: https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.buster_amd64.deb
        sha256: 3e7a93a2ae4a2dd5cccb1b7bcce0eb462c75f05efa314a29499dadfdc5ebc59e

  - name: runner
    buildsystem: simple
    build-commands:
      - echo "python3 /app/src/main/python/main.py" > /app/bin/runner.sh
      - chmod +x /app/bin/runner.sh
